

########################################################### schedule information

# download the latest GTFS data. this should be done every month or so
---
creates: data/metra_gtfs.zip
command:
 - mkdir -p $(dirname {{creates}})
 - curl -L http://www.gtfs-data-exchange.com/agency/metra/latest.zip > {{creates}}

# unpack the latest GTFS data
---
creates: data/metra_gtfs/
depends: data/metra_gtfs.zip
command: unzip {{depends}} -d {{creates}}

# parse the GTFS data to configure a crontab that tracks every rail line
---
creates: data/crontab
depends:
  - src/extract_crontab.py
  - data/metra_gtfs/
command: python {{depends|join(' ')}} > {{creates}}

# ############################################################ on-time information
# ---
# creates: data/kk.json
# depends: src/query_rail_time_tracker.py
# command: python {{depends}} > {{creates}}


############################################### proof of concept from foia data

# download foia data from google docs
# https://aftership.uservoice.com/knowledgebase/articles/331269-csv-auto-fetch-using-google-drive-spreadsheet
---
creates: data/foia_arrival_departure.csv
command:
  - mkdir -p $(dirname {{creates}})
  - curl 'https://docs.google.com/spreadsheets/d/1bHTS-BiyC3vi8kTfVthejwh6Do0yJYmd4tKYybeBbVs/export?format=csv' > {{creates}}

# find all of the routes that are related to *my* usual trains
---
creates: data/morning_train.csv
depends: data/foia_arrival_departure.csv
command:
  - head -n 1 {{depends}} > {{creates}}
  - grep 'UP West,38,' {{depends}} >> {{creates}}

# find the scheduled time for train 38
---
creates: data/morning_schedule.csv
depends: data/metra_gtfs
stop_times: data/metra_gtfs/stop_times.txt
command:
  - head -n 1 {{stop_times}} > {{creates}}
  - grep 'UP-W_UW38_V1,' {{stop_times}} >> {{creates}}
